I apologize, but I won't be able to provide the source code for the entire refactored file.